# MongoDB基础操作
## 目录
  1. [插入数据](#插入数据)
  2. [查询数据](#查询数据)
  3. [更新数据](#更新数据)
  4. [删除数据](#删除数据)
  5. [创建索引](#创建索引)

## 插入数据


## 查询数据
```js
// 查看有多少个数据库
> show dbs
admin    0.000GB
config   0.000GB
local    0.000GB
myDbs    0.000GB
myheros  0.000GB
test     0.000GB
```
```js
// 切换数据库(数据库不存在也没关系)
// 如果test数据库不存在则创建，存在则切换到test数据库
> use test
switched to db test
```
```js
> use demo
switched to db demo
// 删除demo数据库
> db.dropDatabase()
{ "ok" : 1 }
> show dbs
admin    0.000GB
config   0.000GB
local    0.000GB
myDbs    0.000GB
myheros  0.000GB
test     0.000GB
```
```js
// 向test_collection集合中插入数据
> db.test_collection.insert({name: '鲁班七号'})
WriteResult({ "nInserted" : 1 })
```
```js
// 使用find查找数据
// find方法参数为空则返回全部数据
> db.test_collection.find()
{ "_id" : ObjectId("5b8a56d52c0516ea271c4f82"), "name" : "鲁班七号" }
{ "_id" : ObjectId("5b8a96fc2c0516ea271c4f83"), "name" : "后羿" }
// 返回指定name的数据
> db.test_collection.find({name: '后羿'})
{ "_id" : ObjectId("5b8a96fc2c0516ea271c4f83"), "name" : "后羿" }
```
```js
// for循环插入多条数据
> for(i=2;i<100;i++)db.test_collection.insert({x:i})
WriteResult({ "nInserted" : 1 })
```
```js
// 查看集合中数据条数
> db.test_collection.find().count()
100
```
```js
// skip(n) 跳过n条数据
// limit(m) 限制返回m条数据
// sort({x:1}) 根据x字段排序
> db.test_collection.find().skip(3).limit(4).sort({x:1})
{ "_id" : ObjectId("5b8a982c2c0516ea271c4f85"), "x" : 3 }
{ "_id" : ObjectId("5b8a982c2c0516ea271c4f86"), "x" : 4 }
{ "_id" : ObjectId("5b8a982c2c0516ea271c4f87"), "x" : 5 }
{ "_id" : ObjectId("5b8a982c2c0516ea271c4f88"), "x" : 6 }
```

**[⬆ 返回顶部](#async学习总结)**
## 更新数据
```js
// 查询x:3数据
> db.test_collection.find({x:3})
{ "_id" : ObjectId("5b8a982c2c0516ea271c4f85"), "x" : 3 }
// 更新x:3数据为x:333
> db.test_collection.update({x:3}, {x:333})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
```
```js
> db.test_collection.insert({x:100, y:100, z:100})
WriteResult({ "nInserted" : 1 })
// 部分数据更新采用$set
> db.test_collection.update({z:100},{$set:{y:99}})
WriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })
// 查询更新后的结果
> db.test_collection.find({z:100})
{ "_id" : ObjectId("5b8a9be92c0516ea271c4fe6"), "x" : 100, "y" : 99, "z" : 100 }
```
```js
// 第三个参数true，表示当y=100的数据不存在时，自动插入y=999的数据(即要更新的数据)
> db.test_collection.update({y:100},{y:999},true)
WriteResult({
	"nMatched" : 0,
	"nUpserted" : 1,
	"nModified" : 0,
	"_id" : ObjectId("5b8b4e4cc06181d9a6bb896b")
})
> db.test_collection.find({y:999})
{ "_id" : ObjectId("5b8b4e4cc06181d9a6bb896b"), "y" : 999 }
```
```js
db.collection.update(<query>, <update>, {upsert: <boolean>,multi: <boolean>,writeConcern: <document> } )
```
>参数说明：

* query : update的查询条件;
* update : update的对象和一些更新的操作符（如$,$inc...）等；
* upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false；
* multi : 可选，mongodb 默认是false，只更新找到的第一条记录；
* writeConcern :可选，抛出异常的级别。

**[⬆ 返回顶部](#async学习总结)**
## 删除数据
```js
// 删除数据使用remove()方法，该方法必须传入参数，否则报错
> db.test_collection.remove()
2018-09-02T10:51:51.996+0800 E QUERY    [thread1] Error: remove needs a query :
DBCollection.prototype._parseRemove@src/mongo/shell/collection.js:357:1
DBCollection.prototype.remove@src/mongo/shell/collection.js:382:18
@(shell):1:1
// 删除y=999的数据
> db.test_collection.remove({y:999})
WriteResult({ "nRemoved" : 1 })
// 删除数据表
// 语法：db.表名.drop()
> db.test_collection.drop()
true
```
**[⬆ 返回顶部](#async学习总结)**
## 创建索引
>数据量少的时候，不使用索引查询速度还是很快的；但是当数据量较大时，不使用索引的话查询速度将会变的很慢。

```js
// 查看当前集合的索引，目前只有一个_id_索引
> db.myhero.getIndexes()
[
	{
		"v" : 2,
		"key" : {
			"_id" : 1
		},
		"name" : "_id_",
		"ns" : "test.myhero"
	}
]
```
>`MongoDB`使用`ensureIndex()`方法来创建索引
key 为你要创建的索引字段，1为按升序创建索引，-1为按降序创建索引。
也可以设置使用多个字段创建索引（关系型数据库中称作复合索引）
`db.col_name.ensureIndex({key:1})`。需要注意的是：3.0版本后推荐使用`createIndex()`来创建索引。

**[⬆ 返回顶部](#async学习总结)**
